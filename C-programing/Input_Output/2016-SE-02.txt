–ó–∞–¥. 83 2016-SE-02 –î–≤–æ–∏—á–Ω–∏—Ç–µ —Ñ–∞–π–ª–æ–≤–µ f1 –∏ f2 —Å—ä–¥—ä—Ä–∂–∞—Ç 32 –±–∏—Ç–æ–≤–∏ —á–∏—Å–ª–∞ –±–µ–∑ –∑–Ω–∞–∫ (uint32_t). –§–∞–π–ª—ä—Ç f1 –µ
—Å—ä–¥—ä—Ä–∂–∞ ùëõ –¥–≤–æ–π–∫–∏ —á–∏—Å–ª–∞, –Ω–µ–∫–∞ ùëñ-—Ç–∞—Ç–∞ –¥–≤–æ–π–∫–∞ –µ < ùë•ùëñ, ùë¶ùëñ >. –ù–∞–ø–∏—à–µ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ C, –∫–æ—è—Ç–æ –∏–∑–≤–ª–∏—á–∞
–∏–Ω—Ç–µ—Ä–≤–∞–ª–∏—Ç–µ —Å –Ω–∞—á–∞–ª–æ ùë•ùëñ –∏ –¥—ä–ª–∂–∏–Ω–∞ ùë¶ùëñ
–æ—Ç —Ñ–∞–π–ª–∞ f2 –∏ –≥–∏ –∑–∞–ø–∏—Å–≤–∞ –∑–∞–ª–µ–ø–µ–Ω–∏ –≤ –∏–∑—Ö–æ–¥–µ–Ω —Ñ–∞–π–ª f3.
–ü—Ä–∏–º–µ—Ä:
‚Ä¢ f1 —Å—ä–¥—ä—Ä–∂–∞ 4 —á–∏—Å–ª–∞ (2 –¥–≤–æ–π–∫–∏): 30000, 20, 19000, 10
‚Ä¢ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ –∑–∞–ø–∏—Å–≤–∞ –≤ f3 –¥–≤–µ –ø–æ—Ä–µ–¥–∏—Ü–∏ 32-–±–∏—Ç–æ–≤–∏ —á–∏—Å–ª–∞, –≤–∑–µ—Ç–∏ –æ—Ç f2 –∫–∞–∫—Ç–æ —Å–ª–µ–¥–≤–∞:
‚Ä¢ –Ω–∞–π-–Ω–∞–ø—Ä–µ–¥ —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç —á–∏—Å–ª–∞—Ç–∞, –∫–æ–∏—Ç–æ —Å–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 30000, 30001, 30002, ... 30019.
‚Ä¢ —Å–ª–µ–¥ —Ç—è—Ö —Å–µ –∑–∞–ø–∏—Å–≤–∞—Ç —á–∏—Å–ª–∞—Ç–∞ –æ—Ç –ø–æ–∑–∏—Ü–∏–∏ 19000, 19001, ... 19009.

–ó–∞–±–µ–ª–µ–∂–∫–∞: –° –ø—ä–ª–µ–Ω –±—Ä–æ–π —Ç–æ—á–∫–∏ —â–µ —Å–µ –æ—Ü–µ–Ω—è–≤–∞—Ç —Ä–µ—à–µ–Ω–∏—è, –∫–æ–∏—Ç–æ —Ä–∞–±–æ—Ç—è—Ç —Å—ä—Å —Å–∫–æ—Ä–æ—Å—Ç, –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª–Ω–∞
–Ω–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –∏–∑—Ö–æ–¥–Ω–∏—è —Ñ–∞–π–ª f3.


1 #include <unistd.h>
  2 #include <fcntl.h>
  3 #include <err.h>
  4 #include <stdint.h>
  5
  6 typedef struct {
  7     uint32_t x;
  8     uint32_t y;
  9 } Pair;
 10
 11
 12 int main(void){
 13
 14     int f1 = open("f1.bin",O_RDONLY);
 15     if (f1 == -1){
 16         err(1,"Cannot open f1.bin");
 17     }
 18
 19     int f2 = open("f2.bin",O_RDONLY);
 20     if (f2 == -1) {
 21         close(f1);
 22         err(2, "Cannot open f2.bin");
 23     }
 24
 25     int f3 = open("f3.bin",O_WRONLY | O_CREAT | O_TRUNC, 0666);
 26     if (f3 == -1) {
 27         close(f1);
 28         close(f2);
 29         err(3, "Cannot open f3.bin");
 30     }
 31
 32     Pair pair;
 33     ssize_t sizeF1;
 34     ssize_t sizeF2;
 35     while( (sizeF1 = read(f1,&pair,sizeof(pair))) == sizeof(pair)) {
 36         lseek(f2, pair.x* sizeof(uint32_t), SEEK_SET);
 37
 38         uint32_t cnt = pair.y;
 39         uint32_t a;
 40         while( (sizeF2 = read(f2,&a,sizeof(uint32_t))) == sizeof(uint32_t) && cnt > 0) {
 41             cnt--;
 42             if (write(f3, &a, sizeof(uint32_t)) != sizeof(uint32_t)) {
 43                  close(f1); close(f2); close(f3);
 44                  err(5, "Problem writing f3");
 45             }
 48         }
 49         if(sizeF2 == -1){
 50             close(f1);
 51             close(f2);
 52             close(f3);
 53             err(4, "Problem reading from f2");
 54         }
 55
 56     }
  57     if (sizeF1 == -1){
 58         close(f1);
 59         close(f2);
 60         close(f3);
 61         err(6, "Problem while reading from f1");
 62     }
 63
 64
 65     close(f1);
 66     close(f2);
 67     close(f3);
 68
 69     return 0;
 70 }

