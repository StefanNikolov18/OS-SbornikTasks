–ó–∞–¥. 116 2019-SE-01 –ù–∞–ø–∏—à–µ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–∞-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª ùëÉ, –∫–æ—è—Ç–æ –∏–∑–ø—ä–ª–Ω—è–≤–∞ –¥—Ä—É–≥–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ ùëÑ –∏ —è —Ä–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞,
–∫–æ–≥–∞—Ç–æ ùëÑ –∑–∞–≤—ä—Ä—à–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ —Å–∏. –ù–∞ –∫–æ–º–∞–Ω–¥–Ω–∏—è —Ä–µ–¥ –Ω–∞ ùëÉ —Å–µ –ø–æ–¥–∞–≤–∞—Ç —Å–ª–µ–¥–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:
‚Ä¢ –ø—Ä–∞–≥ –∑–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç –≤ —Å–µ–∫—É–Ω–¥–∏ ‚Äì –µ–¥–Ω–æ—Ü–∏—Ñ—Ä–µ–Ω–æ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9
‚Ä¢ ùëÑ
‚Ä¢ –Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–∞ ùëÑ
ùëÉ —Ä–∞–±–æ—Ç–∏ –ø–æ —Å–ª–µ–¥–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç—ä–º:
‚Ä¢ —Å—Ç–∞—Ä—Ç–∏—Ä–∞ ùëÑ —Å –ø–æ–¥–∞–¥–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
‚Ä¢ –∏–∑—á–∞–∫–≤–∞ —è –¥–∞ –∑–∞–≤—ä—Ä—à–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ —Å–∏
‚Ä¢ –∑–∞–ø–∏—Å–≤–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤ —Ñ–∞–π–ª run.log –µ–¥–∏–Ω —Ä–µ–¥ —Å —Ç—Ä–∏ –ø–æ–ª–µ—Ç–∞ - —Ü–µ–ª–∏ —á–∏—Å–ª–∞ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª):
‚Äì –º–æ–º–µ–Ω—Ç –Ω–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ ùëÑ (Unix time)
‚Äì –º–æ–º–µ–Ω—Ç –Ω–∞ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ ùëÑ (Unix time)
‚Äì –∫–æ–¥ –∑–∞ –≥—Ä–µ—à–∫–∞, —Å –∫–æ–π—Ç–æ ùëÑ –µ –∑–∞–≤—ä—Ä—à–∏–ª–∞ (exit code)
‚Ä¢ –ø—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ –µ –∏–∑–ø—ä–ª–Ω–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ—Ç–æ –∑–∞ —Å–ø–∏—Ä–∞–Ω–µ –∏ –∞–∫–æ –Ω–µ –µ, –ø—Ä–µ–º–∏–Ω–∞–≤–∞ –æ—Ç–Ω–æ–≤–æ –∫—ä–º —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ—Ç–æ –Ω–∞ ùëÑ
–£—Å–ª–æ–≤–∏–µ –∑–∞ —Å–ø–∏—Ä–∞–Ω–µ: –ê–∫–æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è—Ç ùëÉ —É—Å—Ç–∞–Ω–æ–≤–∏, —á–µ –ø—Ä–∏ –¥–≤–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏—è –Ω–∞ ùëÑ —Å–∞
–±–∏–ª–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏ –∏ –¥–≤–µ—Ç–µ —É—Å–ª–æ–≤–∏—è:
1. –∫–æ–¥—ä—Ç –∑–∞ –≥—Ä–µ—à–∫–∞ –Ω–∞ ùëÑ –µ –±–∏–ª —Ä–∞–∑–ª–∏—á–µ–Ω –æ—Ç 0;
2. —Ä–∞–∑–ª–∏–∫–∞—Ç–∞ –º–µ–∂–¥—É –º–æ–º–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –∏ –º–æ–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ ùëÑ –µ –±–∏–ª–∞ –ø–æ-–º–∞–ª–∫–∞ –æ—Ç
–ø–æ–¥–∞–¥–µ–Ω–∏—è –∫–∞—Ç–æ –ø—ä—Ä–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—ä—Ä –Ω–∞ ùëÉ –ø—Ä–∞–≥;
—Ç–æ ùëÉ —Å–ø–∏—Ä–∞ —Ü–∏–∫—ä–ª–∞ –æ—Ç –∏–∑–ø—ä–ª–Ω—è–≤–∞–Ω–µ –Ω–∞ ùëÑ –∏ —Å–∞–º –∑–∞–≤—ä—Ä—à–≤–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ—Ç–æ —Å–∏.
–¢–µ–∫—É—â–æ—Ç–æ –≤—Ä–µ–º–µ –≤—ä–≤ —Ñ–æ—Ä–º–∞—Ç Unix time (—Å–µ–∫—É–Ω–¥–∏ –æ—Ç 1 —è–Ω—É–∞—Ä–∏ 1970 –≥.) –º–æ–∂–µ—Ç–µ –¥–∞ –≤–∑–µ–º–µ—Ç–µ —Å –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞
—Å–∏—Å—Ç–µ–º–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è time() —Å –ø–∞—Ä–∞–º–µ—Ç—ä—Ä NULL; —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –µ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–∞ –≤ time.h. –ê–∫–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∞—Ç–∞
–ø—Ä–æ–≥—Ä–∞–º–∞ –µ –±–∏–ª–∞ –ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–∞ –æ—Ç –ø–æ–¥–∞–¥–µ–Ω —Å–∏–≥–Ω–∞–ª, —Ç–æ–≤–∞ —Å–µ –ø—Ä–∏–µ–º–∞ –∑–∞ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ —Å –∫–æ–¥ –∑–∞ –≥—Ä–µ—à–∫–∞ 129.

 1 #include <unistd.h>
  2 #include <fcntl.h>
  3 #include <err.h>
  4 #include <sys/wait.h>
  5 #include <stdbool.h>
  6 #include <time.h>
  7 #include <string.h>
  8 #include <stdint.h>
  9 #include <stdlib.h>
 10
 11 bool isNumber(const char* n){
 12     return strlen(n) == 1 && n[0] >= '1' && n[0] <= '9';
 13 }
 14
 15 void writeToLogTime(int log_fd, time_t time){
 16     if(write(log_fd, &time, sizeof(time_t)) == -1){
 17         close(log_fd);
 18         err(5, "writing to log failed!");
 19     }
 20
 21 }
 22
 23
 24 int main(int argc, char* argv[]){
 25     if (argc < 3){
 26         errx(1,"Invalid argument count. Must be 2 or more");
 27     }
 28     if(!isNumber(argv[1])){
 29         errx(2,"%s is not a number from 1 to 9!", argv[1]);
 30     }
 31
 32     int secs = argv[1][0] - '0';
33
 34     char* qArgs[1024];
 35     int index = 0;
 36
 37     qArgs[index++] = argv[2];
 38     for(int i = 3; i < argc; ++i){
 39         qArgs[index++] = argv[i];
 40     }
 41     qArgs[index] = NULL; //for execvp
 42
 43     int runLog = open("run.log", O_WRONLY | O_CREAT | O_TRUNC, 0666);
 44     if(runLog == -1){
 45          err(404, "run.log cannot open");
 46     }
 47
 48     int times2 = 0;
 49     while(true){
 50
 51         int pid = fork();
 52         if(pid == -1){
 53             close(runLog);
 54             err(3,"fork1");
 55         }
 56         time_t startTime = time(NULL);
 57         time_t finishTime;
 58         if(pid == 0){
 59             //child
 60             execvp(qArgs[0],qArgs);
 61             err(4,"execvp");
62         }
 63         //parent
 64         int status;
 65         wait(&status);
 66         finishTime = time(NULL);
 67
 68         if(WIFSIGNALED(status)){
 69             close(runLog);
 70             exit(129);
 71         }
 72
 73
 74         if(status != 0){
 75             if ((finishTime - startTime) < secs){
 76                 times2++;
 77             }
 78             if(times2 == 2){
 79                 break;
 80             }
 81         }else{
 82             times2 = 0;
 83         }
 84
 85         writeToLogTime(runLog, startTime);
 86         writeToLogTime(runLog, finishTime);
 87
 88         if(write(runLog, &status, sizeof(int)) == -1){
 89             close(runLog);
 90             err(7,"writing status to log!");
 91         }
 92
 93
94     }
 95
 96     close(runLog);
 97
 98     return 0;
 99 }
