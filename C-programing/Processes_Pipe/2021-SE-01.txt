Зад. 120 2021-SE-01 Ваши колеги - асистенти по ОС се оплакват, че студентите упорито ползват командата
sudo, въпреки че им е обяснено да не я ползват. Вашата задача е да подготвите фалшиво sudo, което:
• добавя ред в текстови файл foo.log с командата, която потребителят се е опитал да изпълни
във формат ДАТА ПОТРЕБИТЕЛ ДАННИ, където:
– ДАТА е във формат YYYY-MM-DD HH:MM:SS.UUUUUU (UUUUUU са микросекунди)
– ПОТРЕБИТЕЛ е login name (username) на потребителя
– ДАННИ е всичко, което потребителят е написал, например ./main ls -l /root
– горните полета са разделени с интервал
– пример: 2021-05-10 14:38:17.584344 s99999 ./main ls -l /root
• заключва акаунта, който е изпълнил програмата
• приключва изпълнението на всички процеси, стартирани от този потребител
За да може да изпълни тези неща, фалшивото sudo ще има нужда от root права, а в същото време
трябва да знае кой акаунт изпълнява командата. Традиционно това може да се реши със SUID, което
обаче не важи за shell скриптове. За да заобиколите този проблем, напишете програма на C (main),
която за заключването на акаунта и терминирането на процесите извиква външни shell команди през
pipe().
Полезни man страници:
• gettimeofday(2)
• localtime(3)
• strftime(3)
• getuid(2)
• getpwuid(3)
• passwd(1)
Опишете в doc.txt как бихте настроили компилираната вече програма така, че студентите да ползват
нея, вместо оригиналното sudo.
Естествено, по време на разработка на програмата можете да я тествате само с вашият акаунт и нямате
root права. За да може все пак да тествате, подменете в кода финалните команди, които програмата
изпълнява (тези, които наистина изискват root права), като им добавите едно echo. Например, ако
трябва да изпълните командата
foo -m pesho
вместо това в кода ви трябва да е дефинирано изпълнение на
echo foo -m pesho