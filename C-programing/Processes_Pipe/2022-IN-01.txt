–ó–∞–¥. 121 2022-IN-01 –í–∞—à–∏ –∫–æ–ª–µ–≥–∏ - –∞—Å–∏—Å—Ç–µ–Ω—Ç–∏ –ø–æ –û–° –∏–º–∞—Ç –Ω—É–∂–¥–∞ –æ—Ç –¥–µ–º–æ—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ C, –∫–æ—è—Ç–æ
–¥–∞ —Å–ª—É–∂–∏ –∫–∞—Ç–æ –ø—Ä–∏–º–µ—Ä –∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—Ü–µ—Å–∏. –ù–∞–ø–∏—à–µ—Ç–µ —Ç–∞–∫–∞–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞,
–ø—Ä–∏–µ–º–∞—â–∞ –¥–≤–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—ä—Ä–∞ ‚Äì –µ–¥–Ω–æ—Ü–∏—Ñ—Ä–µ–Ω–∏ —á–∏—Å–ª–∞. –ü—Ä–∏–º–µ—Ä–Ω–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ:
./main N D
–û–±—â –∞–ª–≥–æ—Ä–∏—Ç—ä–º –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞:
‚Ä¢ –Ω–∞—á–∞–ª–Ω–∏—è—Ç (—Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏) –ø—Ä–æ—Ü–µ—Å —Å—ä–∑–¥–∞–≤–∞ –ø—Ä–æ—Ü–µ—Å-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫
‚Ä¢ ùëÅ –Ω–∞ –±—Ä–æ–π –ø—ä—Ç–∏ —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞:
‚Äì —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –∏–∑–≤–µ–∂–¥–∞ –Ω–∞ stdout –Ω–∏–∑–∞ ‚ÄúDING ‚Äù
‚Äì –ø—Ä–æ—Ü–µ—Å—ä—Ç-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –∏–∑–≤–µ–∂–¥–∞ –Ω–∞ stdout –Ω–∏–∑–∞ ‚ÄúDONG‚Äù
‚Äì —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –∏–∑—á–∞–∫–≤–∞ ùê∑ —Å–µ–∫—É–Ω–¥–∏
–ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–π—Ç–µ, —á–µ:
‚Ä¢ –ø—Ä–æ—Ü–µ—Å—ä—Ç-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –≤–∏–Ω–∞–≥–∏ –∏–∑–≤–µ–∂–¥–∞ ‚ÄúDONG‚Äù —Å–ª–µ–¥ –∫–∞—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è –ø—Ä–æ—Ü–µ—Å –µ –∏–∑–≤–µ–ª ‚ÄúDING ‚Äù
‚Ä¢ —Ä–æ–¥–∏—Ç–µ–ª—Å–∫–∏—è—Ç –ø—Ä–æ—Ü–µ—Å –≤–∏–Ω–∞–≥–∏ –∑–∞–ø–æ—á–≤–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ—Ç–æ —Å–ª–µ–¥ –∫–∞—Ç–æ –ø—Ä–æ—Ü–µ—Å–∞-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –µ –∏–∑–≤–µ–ª ‚ÄúDONG‚Äù
–ó–∞–±–µ–ª–µ–∂–∫–∞: –ó–∞ –∏–∑—á–∞–∫–≤–∞–Ω–µ—Ç–æ –ø–æ–≥–ª–µ–¥–Ω–µ—Ç–µ sleep(3).

 1 #include <unistd.h>
  2 #include <err.h>
  3 #include <string.h>
  4 #include <sys/wait.h>
  5 #include <stdlib.h>
  6
  7 int isNumberOneDigit(const char* n){
  8     return strlen(n) == 1 && n[0] >= '0' && n[0] <= '9';
  9 }
 10
 11 int main(int argc,char* argv[]){
 12     if(argc != 3){
 13         errx(1,"Invalid argument count!");
 14     }
 15
 16     if(!isNumberOneDigit(argv[1]) || !isNumberOneDigit(argv[2])){
 17         errx(2,"Params must be one digit numbers!");
 18     }
 19
 20     int N = argv[1][0] - '0';
 21     int D = argv[2][0] - '0';
 22
 23     const char* ding = "DING ";
 24     const char* dong = "DONG ";
 25
 26     int p[2];
 27     if(pipe(p) == -1){
 28         err(3,"pipe");
 29     }
 30
 31     int pid = fork();
 32     if(pid == -1){
 33         close(p[0]);close(p[1]);
 34         err(4,"fork");
 35     }
 36
 37     if(pid == 0){
 38         // child process
 39         close(p[1]); // child –Ω–µ –ø–∏—à–µ
 40         char tmp;
 41         for (int i = 0; i < N; ++i){
 42             if(read(p[0], &tmp, sizeof(char)) != 1){
 43                 close(p[0]);
 44                 err(5,"child reading from pipe");
 45             }
 46             if(write(1, dong, strlen(dong)) == -1){
 47                 close(p[0]);
 48                 err(7,"wruting to stdout failed");
 49             }
 50         }
 51         close(p[0]);
 52         exit(0);
 53     }
 54
 55     // parent process
 56     close(p[0]); // parent –Ω–µ —á–µ—Ç–µ
 57     char signal = 'x';
 58     for (int i = 0; i < N; ++i){
 59         write(1, ding, strlen(ding));   // parent –ø–∏—à–µ DING
 60         if(write(p[1], &signal, sizeof(char)) != 1){
 61             close(p[1]);
 62             err(6,"parent writing to pipe");
 63         }
 64         sleep(D);  // –∏–∑—á–∞–∫–≤–∞ D —Å–µ–∫—É–Ω–¥–∏
 65     }
 66     close(p[1]);
 67
 68     wait(NULL); // –∏–∑—á–∞–∫–≤–∞ child
 69     return 0;
 70 }
 71
