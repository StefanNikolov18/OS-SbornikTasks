Зад. 74 2025-IN-01
Вашите колеги от съседната лаборатория трябва периодично да променят правата за достъп до обекти
във файловата система на база на текстови файл с описание на необходимата конфигурация. Всеки
ред на файла дефинира правило, което гарантирано се състои от три низа, разделени с whitespace.
Примерно съдържание на файла:
/tmp/one R 700
/tmp/two A 700
/tmp/four A 750
/tmp/twenty T 750
Всяко правило описва на кои обекти трябва да се променят правата, като трите низа определят:
• начална директория в която да се търсят обекти за това правило; не съдържа специални символи;
• тип – една от следните три букви, която дефинира как се интерпретират битовете в третия низ:
– R (raw) – обектът трябва да има точно тези битове за права
– A (any) – обектът трябва да има вдигнат поне един от указаните битове
– T (target) – обектът трябва да има вдигнати всичките указани битове
• девет бита, дефиниращи права за достъп във файлова система, представени по стандартния
начин като трицифрено число в осмична бройна система.
Напишете bash скрипт perm.sh, който по подаден аргумент – име на файл с конфигурация, ако се
изпълнява от root потребителя, извършва необходмите промени на правата при следните изисквания:
• правилата се обработват и прилагат линейно;
• като обекти във файловата система се обработват само обикновени файлове и директории;
• всички обекти биха могли да имат специални символи в името си;
• началните директории не се третират като обекти, чиито права трябва да се променят.
Правата на намерените обекти се променят на каквито биха били, 
ако съответния обект е бил създаден с ефективна umask-а съответно:
• 022 за директории и
• 002 за файлове.


  1 #!/bin/bash
  2
  3 [[ "$#" -ne 1 ]] && echo "Invalid arg cnt! Must be one!" >&2 && exit 1
  4 [[ "$EUID" -ne 0 ]] && echo "Its not from root!" >&2 && exit 2
  5
  6 [[ ! -f "$1" ]] && echo "Given argument is not a file!" >&2 && exit 3
  7
  8 config="$1"
  9
 10 while read -r path type mod; do
 11
 12     if [[ "$type" == "R" ]]; then
 13         while read -r -d '' filename; do
 14             if [[ -d "$filename" ]]; then
 15                 chmod 755 "$filename"
 16             elif [[ -f "$filename" ]]; then
 17                 chmod 664 "$filename"
 18             fi
 19         done < <(find "$path" -mindepth 1 -perm "$mod" -print0)
 20     elif [[ "$type" == "A" ]]; then
 21         while read -r -d '' filename; do
 22             if [[ -d "$filename" ]]; then
 23                 chmod 755 "$filename"
 24             elif [[ -f "$filename" ]]; then
 25                 chmod 664 "$filename"
 26             fi
 27         done< <(find "$path" -mindepth 1 -perm /"$mod" -print0)
 28     else #T
 29         while read -r -d '' filename; do
 30             if [[ -d "$filename" ]]; then
 31                 chmod 755 "$filename"
 32             elif [[ -f "$filename" ]]; then
 33                 chmod 664 "$filename"
 34             fi
 35         done< <(find "$path" -mindepth 1 -perm -"$mod" -print0)
 36     fi
 37
 38 done < "$config"
 39
 40
 41

