Зад. 76 2025-SE-01
Ваш бивш съученик, с когото не сте се чували от 11 години, се свързва с вас и спешно иска помощ с
автоматизация на използването на външния инструмент ANTLR, който вие имате вече инсталиран
на компютъра си.
Напишете скрипт build.sh, който се управлява с конфигурационни файлове, имащи следния вид:
<език> <желани типове изходни файлове> '<базова изходна директория>'
Примерен такъв конфигурационен файл:
Go recognizer listener '/foo'
JavaScript visitor recognizer '/bar'
Java listener recognizer visitor '/baz'
build.sh трябва да приема два аргумента:
• Име на конфигурационен файл (подобен на примерния от по-горе)
• Име на входен файл (съдържанието му не ни интересува)
build.sh трябва да извика ANTLR по веднъж за всеки ред от конфигурационния файл, така че да
създаде нужните изходни файлове в съответните изходни директории.
Извикването става по следния начин:
antlr4 -Dlanguage=<език> <опции> -o <изходна директория> <входен файл>
Изходната директория трябва да е поддиректория с име, съответстващо на името на входния файл,
но без разширение, и намираща се в базовата изходна директория.
Инструментът ANTLR генерира изходни файлове спрямо следните правила:
• Recognizer файловете се генерират винаги
• Listener файловете се генерират ако не е подадена опция -no-listener
• Visitor файловете се генерират ако е подадена опция -visitor
Ако приемем, че конфигурационният файл се казва Antlrfile, примерното извикване
./build.sh Antlrfile grammar/Query.g4
трябва да доведе до извикване на следните команди:
antlr4 -Dlanguage=Go -o /foo/Query grammar/Query.g4
antlr4 -Dlanguage=JavaScript -no-listener -visitor -o /bar/Query grammar/Query.g4
antlr4 -Dlanguage=Java -visitor -o /baz/Query grammar/Query.g4
ANTLR сам ще се погрижи да създаде нужните файлове в съответните изходни директории

   1 #!/bin/bash
  2
  3 [[ "$#" -ne 2 ]] && echo "Invalid args cnt. Must be 2" >&2 && exit 1
  4 [[ ! -f "$1" ]] && echo "$1 is not existing file" >&2 && exit 2
  5 [[ ! -f "$2" ]] && echo "$2 is not existing file" >&2 && exit 3
  6
  7 antlrfile="$1"
  8 outf="$2"
  9
 10 filename="${outf##*/}"
 11 razshirenie="${filename#*.}"
 12 nameFile="${filename%.*}"
 13
 14 while read -r lang opts dir; do
 15     # махаме кавичките от пътя
 16     path="${dir//\'/}"
 17
 18     # по подразбиране: always recognizer
 19     args=""
 20
 21     # проверка за listener и visitor
 22     isListener=1
 23     isVisitor=0
 24     for opt in $opts; do
 25         [[ "$opt" == "listener" ]] && isListener=0
 26         [[ "$opt" == "visitor" ]] && isVisitor=1
 27     done
 28
 29     [[ $isListener -eq 0 ]] && args="$args -no-listener"
 30     [[ $isVisitor -eq 1 ]] && args="$args -visitor"
 31
 32     # извикване на ANTLR
 33     antlr4 -Dlanguage="$lang" $args -o "$path/$nameFile" "$outf"
 34
 35 done < "$antlrfile"
 36
 37 exit 0
~

