Зад. 79 2025-SE-04

Софтуерът BOMBA, който ползвате от години, се конфигурира чрез множество текстови файлове, съдържащи редове от вида <ключ>=<стойност>.
Примерно съдържание на такъв файл:
foo=the quick brown fox
foo=jumps over the lazy dog
bar=123456
baz=baba penka
bar=789
За зла беда, новият софтуер BOMBA2 се конфигурира чрез същите ключове и стойности, но с обновен
синтаксис. Ключовете, имащи повече от една зададена стойност, вече се групират като списъци. Ето
как би изглеждал примерният файл, преведен до новия формат:
foo:
- the quick brown fox
- jumps over the lazy dog
bar:
- 123456
- 789
baz: 
- baba penka
За да мигрирате по-лесно, напишете скрипт convert_to_bcf2.sh, който приема два аргумента (стара
директория и нова директория). Всеки обикновен файл в старата директория (и нейните поддиректории) с име, завършващо с .bcf, трябва:
• Да се запише в новата директория, запазвайки директорийната структура, но преименувайки
файла от <име>.bcf на <име>.bcf2
• Да се преведе от стария конфигурационен синтаксис до новия

  1 #!/bin/bash
  2
  3 [[ "$#" -ne 2 ]] && echo "Invalid args cnt! Must be 2" >&2 && exit 1
  4 [[ ! -d "$1" ]] && echo "$1 is not dir!" >&2 && exit 2
  5 [[ ! -d "$2" ]] && echo "$2 is not dir!" >&2 && exit 3
  6
  7 src="$1"
  8 dest="$2"
  9
 10 #pyrvo shte q premesta kakto e
 11
 12 cp -a "$src/." "$dest/"
 13
 14 mainDir="$dest"
 15
 16
 17 while read -r file; do
 18
 19     newFile="${file%.bcf}.bcf2"
 20     touch "$newFile"
 21
 22     currK=""
 23     while IFS='=' read -r k v; do
 24         if [[ "$k" != "$currK" ]]; then
 25             currK="$k"
 26             echo "$currK:" >> "$newFile"
 27         fi
 28
 29         echo "- $v" >> "$newFile"
 30
 31     done < (sort -t'=' -k1 "$file")
 32
 33     rm "$file"
 34
 35 done < <(find "$mainDir" -type f -name "*.bcf" )
 36
 37 exit 0
~

